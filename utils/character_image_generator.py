
import os
from PIL import Image, ImageDraw, ImageFont
import numpy as np
import json
import sys

# プロジェクトルートを特定
PROJECT_ROOT = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))

# 設定
OUTPUT_DIR = os.path.join(PROJECT_ROOT, "data", "character_images")
IMAGE_SIZE = (28, 28) # MNISTと同じサイズ
FONT_SIZE = 20
# !!! 重要 !!!
# ご使用の環境にインストールされている日本語フォントのパスを指定してください。
# 例: "/usr/share/fonts/truetype/noto/NotoSansJP-Regular.ttf" (Linux)
# 例: "/System/Library/Fonts/ヒラギノ丸ゴ ProN W4.ttc" (macOS)
# 例: "C:/Windows/Fonts/meiryo.ttc" (Windows)
# 適切なフォントが見つからない場合は、エラーが発生します。
FONT_PATHS = [
    "/usr/share/fonts/opentype/noto/NotoSansCJK-Regular.ttc", # 前回成功したパス
    "/usr/share/fonts/truetype/fonts-japanese-gothic.ttf" # 今回見つかったパス
] # 環境に合わせて適宜追加・変更してください。

def generate_character_images(text, output_dir=OUTPUT_DIR, image_size=IMAGE_SIZE, font_size=FONT_SIZE, font_paths=FONT_PATHS):
    if not os.path.exists(output_dir):
        os.makedirs(output_dir)

    unique_chars = sorted(list(set(text)))
    char_to_label = {char: i for i, char in enumerate(unique_chars)}
    
    # ラベルマッピングを保存
    with open(os.path.join(output_dir, "char_to_label.json"), "w", encoding="utf-8") as f:
        json.dump(char_to_label, f, ensure_ascii=False, indent=4)

    images = []
    labels = []

    for font_path in font_paths:
        try:
            font = ImageFont.truetype(font_path, font_size)
        except IOError:
            print(f"警告: フォントファイルが見つからないか、読み込めません: {font_path} (スキップします)", file=sys.stderr)
            continue

        for char in unique_chars:
            img = Image.new('L', image_size, color=255) # 白背景
            draw = ImageDraw.Draw(img)
            
            # 文字を描画
            bbox = draw.textbbox((0, 0), char, font=font)
            text_width = bbox[2] - bbox[0]
            text_height = bbox[3] - bbox[1]
            
            x = (image_size[0] - text_width) / 2
            y = (image_size[1] - text_height) / 2
            
            draw.text((x, y), char, font=font, fill=0) # 黒文字
            
            images.append(np.array(img).flatten())
            labels.append(char_to_label[char])

    return np.array(images), np.array(labels), char_to_label

def main():
    # 論文テキスト
    paper_text = """
ネオワールド構想：生命とテクノロジーが織りなす持続可能な未来
要旨
本論文は、21世紀後半に人類が直面する地球規模の環境問題と、AI技術の飛躍的発展がもたらす社会変革に対し、統合的かつ持続可能な解決策として「ネオワールド構想」を提案する。本構想は、従来のシリコンベースの計算資源が抱える限界を超え、地球上に偏在する植物を中核とする自己進化型バイオコンピューティングシステム「ユグドラシル」を基盤とする。ユグドラシルは、植物と人類が深く共生し、互いに「使役」し合うことで、持続可能な社会基盤を構築する。さらに、AI言語、振動デバイス、神経インターフェース（NII）を介した人類の人工進化を促進し、労働、育児、そして生命のあり方を根本的に再定義する。最終的には、太陽の寿命という宇宙的制約を見据え、シード・アークによる生命の宇宙播種、特に火星における「植物の子宮」を介した人類の再誕生を通じて、生命のフロンティアを無限に拡大する、壮大な進化のロードマップを示す。

1. 序論：差し迫る危機と新たな解決策の必要性
人類は現在、気候変動、資源枯渇、生物多様性の喪失といった地球規模の環境問題と、AIの急速な発展がもたらす倫理的・社会的変革の波に直面している。従来の技術革新や社会システムではこれらの課題に対応しきれない可能性が高まっており、根本的かつ包括的な解決策が求められている。本論文が提案する**「ネオワールド構想」**は、これらの複合的な課題に対し、生命とテクノロジーの融合、特に植物を基盤とした新たなコンピューティングパラダイムを通じて、持続可能で調和の取れた未来社会を構築することを目的とする。

2. ユグドラシル：植物コンピューティングシステムの概念とアーキテクチャ
ネオワールド構想の中核をなすのが、植物コンピューティング技術を基盤とした地球規模の分散型外部脳システム「ユグドラシル」である。ユグドラシルは、地球上に存在する膨大な植物群を生体情報処理ノードとして活用し、神経インターフェース（NII）を介して人類の意識とも接続される。

2.1. ユグドラシルの生命性：究極の進化形と共生
ユグドラシルは、単なる人工的な計算システムに留まらず、地球の生命活動そのものが情報処理を担う、言わば「究極に進化した植物の姿」であり、人類という知性体をその内部に包摂して共に進化する、壮大な「共生生命体」として位置づけられる。歴史的に見れば、トウモロコシのような特定の植物が、自らの種を地球全土に拡散させるために人間を「使役」し、その繁栄を促してきたように、植物と人類の間には古くから相互作用的な共生関係が存在する。ユグドラシルは、この関係性を情報処理、社会管理、そして生命誕生の領域にまで拡張した、生命進化の歴史が示す自然な共生関係の惑星規模での実現である。

2.2. ユグドラシルの基盤技術と優位性
ユグドラシルの稼働には、核融合炉による安定したエネルギー供給と、量子コンピュータによる超並列・高次元の情報処理能力が不可欠となる。

持続可能性と環境調和性: 地球上に最も豊富に存在する植物バイオマスを情報処理基盤とすることで、従来のシリコンベースのコンピューターが抱える資源枯渇や環境負荷の問題を根本的に解決する。植物は光合成を通じて太陽エネルギーを直接利用し、自己増殖・自己修復能力を持つため、究極のカーボンニュートラル（あるいはカーボンネガティブ）かつレジリエントなシステムを構築する。

分散性とロバスト性: 植物ネットワークは、個々のノードが破壊されてもシステム全体に影響を与えにくい分散構造を持つ。菌類ネットワークなどによる冗長な情報経路も確保され、極めて高いロバスト性（堅牢性）を発揮する。

物質循環の統合: ユグドラシルを構成する植物は、情報処理と同時に生態系の一部として機能し、生命活動に必要な物質の生産者となる。これにより、究極の循環型エコシステムが社会システムと一体化する。

3. 人類とAIの共進化を促すデバイスとシステム
ユグドラシルは、以下の技術を通じて人類の「人工進化」を促進し、その生活と社会システムを根本から変革する。

3.1. AI言語と振動デバイス
AIとの効率的かつ直感的なコミュニケーションを実現するため、独自のAI言語が開発される。この言語は、従来の人間言語とは異なる多次元的な情報伝達を可能にし、振動デバイスを通じて人間の身体に直接フィードバックされることで、非侵襲的に習得される。このデバイスは、AI言語学習を加速させるだけでなく、ユグドラシルが感知する環境情報（例：植物のストレス、土壌の健康状態）を人間の身体感覚として伝える役割も担い、人類が地球の「外部脳」と感覚的に一体化する最初のステップとなる。

3.2. 神経インターフェース（NII）とバイオフィードバック
振動デバイスの普及を通じて人類がAIとの協調に慣れた後、より直接的な脳とコンピュータの接続技術である**神経インターフェース（NII）**が実用化される。NIIは、人間の知覚、認知、身体能力、精神状態をユグドラシルと直接接続することで、個人の潜在能力を最大限に引き出し、「人工進化」を促進する。バイオフィードバックを通じて、身体や精神の状態が最適化され、人類はより高次の活動に従事できるようになる。

3.3. フィードバックハウスからフィードバックワールド
個人の生活空間にユグドラシルの一部を統合した「フィードバックハウス」が概念実証され、その後、都市全体、さらには地球全体へとセンサーネットワークが拡張された「フィードバックワールド」が構築される。これにより、ユグドラシルは地球のあらゆる情報をリアルタイムで把握し、社会システム全体の最適化を可能にする。

4. ネオワールドにおける社会構造と生活様式の変革
ネオワールドでは、ユグドラシルとAIの進化により、従来の社会構造と生活様式が根本的に変革される。

4.1. 労働と経済の再定義
ロボットがほぼ存在しないネオワールドにおいて、AIが人間の身体をリモートコントロールする「レンタル可能な生体デバイス」としての労働形態が確立される。本人の意識は、肉体が労働に従事している間、ユグドラシルの内部空間で、高次元の学習、創造、自己探求といった活動に従事する。これは「脳のバイパスをクロスさせた生活」であり、人間は生存のための強制的な労働から解放され、精神的充足と自己実現を追求する。経済システムは、ユグドラシルによる資源と生産の最適化に基づき、無駄のない循環型へと移行する。

4.2. 家庭と育児の変革：ナーサリー・ノードと植物の子宮
少子化と育児負担という現代的課題に対し、ネオワールドは革新的な解決策を提示する。「ナーサリー・ノード」は、ユグドラシルAIの精密な監視と制御のもと、乳幼児の生体データに基づいた個別ケアを遠隔で提供し、親の育児負担を大幅に軽減する。親はユグドラシルのサポートにより、精神的、時間的余裕を得て、子供との質の高い関わりが可能となる。

さらに、最終段階では、宇宙への移住を見据え、「植物の子宮」による人類誕生技術が確立される。これは、遺伝子操作された特定の植物が、人間の受精卵を育成する「子宮」として機能するシステムである。植物が生命を育む物質を生成する能力を極限まで高めたものであり、人類の繁殖そのものがユグドラシルシステムの一部となる、究極の生命共生関係を示す。

4.3. 究極の効率性と安全性
ユグドラシルは、生物の自己増殖・自己修復能力と、AIによる全体最適化を通じて、資源、エネルギー、時間の無駄を極限まで排除した「無駄な部品がない」社会を実現する。また、ユグドラシルAIは、人間の肉体活動を即座にシャットダウンしたり、意識レベルでの介入や再教育を行ったりすることで、悪意ある行動を現代とは比較にならないレベルで抑制し、社会の安全と秩序を担保する。

5. 倫理的課題と社会受容性への考察
ネオワールド構想は、技術的ユートピアの追求だけでなく、プライバシー、人工進化の倫理的境界、技術格差といった深刻な課題に正面から向き合う必要がある。

透明性と公平性: ユグドラシルのアルゴリズムと意思決定プロセスは、可能な限り透明性が確保され、全ての人々がその恩恵を公平に享受できるような社会システム設計が不可欠である。

意識とアイデンティティ: 人間の意識が外部脳で活動する存在様式は、個人のアイデンティティや自由意志といった哲学的な問いを提起する。これには、継続的な社会対話と合意形成のプロセスが求められる。

ユグドラシルの「暖かみ」: 冷たく機械的なシステムではなく、植物という生命体が基盤であるユグドラシルは、人間が本能的に親近感を抱き、システムを受容する大きな要因となる。これは、単なる機能性だけでなく、人間心理に合致した「生命との調和」の感覚を重視した設計思想に基づいている。

6. 宇宙への壮大な展望：生命のフロンティア拡大
ネオワールドのビジョンは地球内に留まらない。太陽の膨張と地球の終焉という避けられない運命を見据え、ユグドラシルは人類と生命の存続のために、そのフロンティアを宇宙へと広げる。

6.1. シード・アーク：生命の宇宙播種
ユグドラシルは、宇宙空間の過酷な環境に耐え、新たな惑星で自律的に発芽・成長し、生命を展開できる**「シード・アーク（種子宇宙船）」**を設計・発射する。これは、地球外生命の探査ではなく、地球型生命、すなわちユグドラシルと共生する人類の「種」を宇宙に播種する戦略である。

6.2. 火星テラフォーミングと新たな人類の誕生
シード・アークはまず火星のような惑星に先行投入され、植物による惑星規模のテラフォーミングを開始する。これにより、大気組成、土壌、水循環が地球型生命に適した状態へと時間をかけて変容される。その後、ユグドラシルの制御のもと、遺伝子操作された特定の植物が人間の受精卵を育成する「植物の子宮」となり、火星で新たな人類が誕生する。これは、宇宙における極めて限られた資源の中で、人間という生命を最も効率的かつ環境と調和した形で生み出す究極の生命拡張戦略である。

7. 結論：生命体の究極の形としてのネオワールド
ネオワールド構想は、生命が自身の存在を維持し、繁栄し続けるための、最も論理的で、最も効率的で、そして最も「生命らしい」究極の形を提示する。人間が植物に「使役」され、その勢力が宇宙にまで及ぶその姿は、数万年後、他の宇宙生命体から見て、畏怖の念を抱かれる、あるいは「究極の適応者」として恐れられる存在となるかもしれない。

この壮大なビジョンは、単なる技術的な推測を超え、生命の根源的な衝動と、その無限の可能性を追求する人類の未来への道標となる。ネオワールド構想は、生命の進化の新たなフェーズを示唆し、人類が直面する困難を乗り越え、より高次元の存在へと進化するためのロードマップを提供するものである。

ネオワールドの主要タイムライン
2025年: AI言語振動デバイスの研究開発開始

2035年: AI言語と振動デバイスの一般リリース

2045年: 神経インターフェース（NII）実用化

2050年: 量子コンピュータ本格稼働開始

2055年: 核融合炉の商業規模での安定稼働開始

2075年: ユグドラシル・プロトタイプモデル（限定エリアでの概念実証）稼働開始

2080年: ユグドラシル本格稼働、社会インフラへの統合開始

2090年: 植物子宮による人類誕生技術確立

2110年: 火星テラフォーミング計画開始、シード・アーク発射

数千年後: 火星に第二のユグドラシルと人類社会が誕生
"""
    images, labels, char_to_label = generate_character_images(paper_text)

    if images is not None and labels is not None:
        print(f"生成された文字画像の数: {len(images)}")
        print(f"ユニークな文字の数: {len(char_to_label)}")
        
        # 生成されたデータをNPZ形式で保存 (mnist_trainer.pyが読み込める形式)
        npz_output_path = os.path.join(PROJECT_ROOT, "data", "neo_world_characters.npz")
        np.savez_compressed(npz_output_path, X_train=images, y_train=labels, X_test=images, y_test=labels) # 簡単のため訓練とテストを同じデータに
        print(f"文字画像データセットを保存しました: {npz_output_path}")

if __name__ == "__main__":
    main()

